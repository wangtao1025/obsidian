# Python 语法手册：身份判断( == 与 is) 与 成员运算符号 (in 与 not in)

← [语法手册总览](/python/python语法手册) | 下一章见总览

---

**本章对应自测卷**：[七、身份判断与成员运算符（共 8 题）](/python/Python核心语法自测试卷#七身份判断与成员运算符-共-8-题)  
**学完能做什么**：分清 `==` 与 `is` 的用法，知道 `in` 在列表/字典/集合里的时间复杂度，避免用 `is` 比较数值或字符串。  
**小白注意**：① `==` 比内容，`is` 比内存地址；判空用 `is None`。② `in` 在列表/字符串是 O(n)，在集合/字典键是 O(1)；字典默认查键不查值。③ 不要用 `is` 比较数字或字符串是否相等，要用 `==`。

---

## 七、身份判断( == 与 is) 与 成员运算符号 (in 与 not in)

### 7.1 身份运算符: == 和 is
核心直觉： == 问的是“内容像不像”，is 问的是“是不是同一个人”。

| **运算符**             | **比较维度**          | **判断依据**         | **对应底层方法**          |
| ------------------- | ----------------- | ---------------- | ------------------- |
| == / !=             | **值 (Value)**     | 比较两个对象的内容是否相等    | `__eq__` / `__ne__` |
| **`is` / `is not`** | **身份 (Identity)** | 比较内存地址 (id) 是否相同 | `id(a) == id(b)`    |
|                     |                   |                  |                     |
#### 7.1.1 场景实战

```python
# 情况 A：内容相同，但内存地址不同
list_a = [1, 2, 3]
list_b = [1, 2, 3]
print(list_a == list_b)    # True  (内容一模一样)
print(list_a is list_b)    # False (在内存中是两个独立的盒子)

# 情况 B：通过赋值，指向同一个地址
list_c = list_a
print(list_a is list_c)    # True  (c 只是 a 的一个别名)
```

#### 7.1.2 `None` 的判断

在 Python 中，`None` 是一个**单例对象 (Singleton)**。整个解释器运行期间，内存里只有一个 `None`。

- **推荐做法**：始终使用 `is None` 或 `is not None`。

- **原因**：性能更快（直接比地址），且能防止自定义类重载了 == 运算符导致的逻辑错误。

```python
# 黄金准则：永远不要写 == None
if my_variable is not None:
    print("变量有值")
```

#### 7.1.3 性能优化陷阱：小整数与短字符串缓存

Python 会缓存 **-5 到 256** 之间的整数以及**短字符串**，以节省内存。这会导致一些“违反直觉”的情况：

```python
a = 256
b = 256
print(a is b)      # True (命中缓存，地址相同)

x = 257
y = 257
print(x is y)      # False (超出缓存范围，创建了新对象)
```

⚠️ **警惕**：永远不要依赖 `is` 来比较数字或字符串的大小，务必使用 ==

### 7.2 成员运算符： in 和 not in
用于测试某个值是否是序列或者可迭代对象的成员，返回布尔值
#### 7.2.1 不同结构的查找逻辑（自测卷 7.5 待复习）

|**数据结构**|**查找对象**|**复杂度**|**性能特点**|
|---|---|---|---|
|**字符串**|字符/子串|$O(n)$|唯一支持**子串**查找（如 `'py' in 'python'`）。|
|**列表/元组**|元素|$O(n)$|数据量越大越慢（需从头扫描）。|
|**集合 (Set)**|元素|**$O(1)$**|**最快**（基于哈希表，瞬间定位）。|
|**字典 (Dict)**|**键 (Key)**|**$O(1)$**|默认只找键！找值需用 `.values()`（性能降至 $O(n)$）。|
#### 7.2.2 字典查找陷阱
```python
d = {'a': 1, 'b': 2}
print('a' in d)          # True (键存在)
print(1 in d)            # False (默认不找值！)
print(1 in d.values())   # True (手动查值，但失去了 O(1) 速度)
print(('a', 1) in d.items()) # True (查键值对是否存在)
```

#### 7.2.3 自定义对象支持 `in`
通过在类中定义 `__contains__` 方法，可以让自定义对象支持成员运算。
```python
class MyClass:
    def __init__(self, data):
        self.data = data
    def __contains__(self, item):
        return item in self.data # 核心逻辑

obj = MyClass([1, 2, 3])
print(2 in obj) # True
```

---

**本章小结**：`==` 比值（调 `__eq__`），`is` 比 id；None 用 `is None`。`in`：list/str O(n)，set/dict 键 O(1)；字典默认查键，查值用 `in d.values()`。自定义 `in` 实现 `__contains__`。
